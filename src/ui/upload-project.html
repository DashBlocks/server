<h1>Upload Project</h1>
<div id="status"></div>
<form id="uploadForm">
  <input type="file" id="projectFile" accept=".dbp" required />
  <input type="text" id="projectName" placeholder="Project name" required />
  <button type="submit">Upload</button>
</form>

<script>
  const sessionData = await fetch(`${window.location.origin}/session`, {
    headers: { "Content-Type": "application/json" },
  }).then(res => res.json()).catch(() => null);
  const session = sessionData ? sessionData : null;

  if (!session || !session.userId || !session.username)
    document.body.innerHTML = "<a href='/login'>Log in first</a>";

  document.getElementById("uploadForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const status = document.getElementById("status");
    const fileInput = document.getElementById("projectFile");
    const nameInput = document.getElementById("projectName");

    status.innerText = "Uploading...";

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);
    formData.append("name", nameInput.value);

    try {
      const response = await fetch(`${window.location.origin}/save-project`, {
        method: "POST",
        body: formData,
      });

      const result = await response.json();
      if (result.ok) {
        status.innerHTML = "Project uploaded!!!! ID: " + result.projectId;
      } else {
        status.innerHTML = "Error while uploading: " + result.error;
      }
    } catch (error) {
      status.innerHTML = "Error: " + error.message;
    }
  });
</script>
